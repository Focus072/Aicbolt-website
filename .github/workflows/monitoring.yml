name: Continuous Monitoring

on:
  push:
    branches:
      - main
  schedule:
    - cron: '*/15 * * * *' # Run every 15 minutes
  workflow_dispatch: # Allows manual triggering

jobs:
  monitor:
    runs-on: ubuntu-latest
    env:
      NEXT_PUBLIC_BASE_URL: ${{ secrets.VERCEL_URL }} # Use Vercel URL for production monitoring
      ALERT_EMAIL: ${{ secrets.ALERT_EMAIL }}
      EMAIL_PASS: ${{ secrets.EMAIL_PASS }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Or your project's Node.js version

      - name: Install dependencies
        run: npm install

      - name: Run Health Check
        run: node monitoring/health-check.js
        continue-on-error: true # Don't fail the workflow if health check fails

      - name: Run Performance Monitor
        run: node monitoring/performance-monitor.js
        continue-on-error: true

      - name: Run Resilience Test
        run: node monitoring/resilience-test.js
        continue-on-error: true

      - name: Upload Performance Report
        uses: actions/upload-artifact@v4
        with:
          name: performance-report
          path: monitoring-reports/performance-report.md
          if-no-files-found: ignore # Don't fail if report not generated